@model GymTrack.Models.TrainingViewModel

@{
    ViewBag.Title = "Add Training";
}

<div class="secondheader">
    <h2> Training for @Model.Date.ToShortDateString()</h2>
</div>




<div id="trainingContainer">
    <form id="excerciseForm" method="post" action="/Training/Create">
            <h3>Ćwiczenie</h3>

            @Html.Label("Nazwa")
            <input type="text" id="nameInput"/>

            @Html.Label("Ciezar")
            <input type="number" id="weightInput" step="2.5"  />

            @Html.Label("Powtorzenia")
            <input type="number" id="repsInput"/>

            @Html.Label("Serie")
            <input type="number" id="setsInput" />

            <button type="button" onclick="addExcercise()">Dodaj cwiczenie</button>

            <button type="submit">Zapisz trening</button>
        </form>

        <div id="excerciseList">
        </div>


</div>


<script>
    let excerciseIndex = 0;

    function addExcercise() {
    const name = document.getElementById("nameInput").value;
    const weight = document.getElementById("weightInput").value;
    const reps = document.getElementById("repsInput").value;
    const sets = document.getElementById("setsInput").value;

    if(!name || !weight || !reps || !sets)
    {
        alert("Uzupelnij wszystkie pola");
        return;
    }
    
    const container = document.createElement("div");
    container.classList.add("excerciseList");
    container.dataset.excerciseIndex = excerciseIndex;    

    const text = document.createElement("span");
    text.innerText = `${name} - ${weight}kg x ${reps} powtorzen x ${sets} serii`;
    container.appendChild(text);

    const removeButton = document.createElement("button");
    removeButton.innerText = `Usun`;
    removeButton.style.marginLeft = "10px";
    removeButton.onclick = function() {
        document.querySelectorAll(`input[data-owner="${excerciseIndex}"`).forEach(input => input.remove());
        container.remove();
    }
    
    container.appendChild(removeButton);

    document.getElementById("excerciseList").appendChild(container);

    const fields = [
        { name: `Excercise[${excerciseIndex}].Name`, value: name },
        { name: `Excercise[${excerciseIndex}].Weight`, value: weight },
        { name: `Excercise[${excerciseIndex}].Reps`, value: reps },
        { name: `Excercise[${excerciseIndex}].Sets`, value: sets } 
    ];

    fields.forEach(field =>{
        const input = document.createElement("input");
        input.type = "hidden";
        input.name = field.name;
        input.value = field.value;
        input.setAttribute("data-owner", excerciseIndex);
        document.getElementById("excerciseForm").appendChild(input);
    });

    excerciseIndex++;

    // document.getElementById("nameInput").value = "";
    // document.getElementById("weightInput").value = "";
    // document.getElementById("repsInput").value = "";
    // document.getElementById("setsInput").value = "";
    }
</script>