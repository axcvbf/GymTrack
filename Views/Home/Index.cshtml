@using GymTrack.ViewModels
@using System.Globalization
@model HomeViewModel

@{
    ViewData["Title"] = "Calendar";

    var currentDate = Model.currentDate;
    int daysInMonth = DateTime.DaysInMonth(currentDate.Year, currentDate.Month);
    int startDay = (int)currentDate.DayOfWeek;

    startDay = startDay == 0 ? 6 : startDay - 1;

    var trainingDays = Model.trainingDays as List<DateTime> ?? new List<DateTime>();
}

<div class="calendar">
    <div class="month">
        <a href="?month=@(Model.currentDate.AddMonths(-1).Month)&year=@(Model.currentDate.AddMonths(-1).Year)">
            <i class="fa fa-angle-left prev"></i>
        </a>
        <div class="date">
            <h2>@(Model.currentDate.ToString("MMMM yyyy", new CultureInfo("en-US")))</h2>
        </div>
        <a href="?month=@(Model.currentDate.AddMonths(1).Month)&year=@(Model.currentDate.AddMonths(1).Year)">
            <i class="fa fa-angle-right next"></i>
        </a>
    </div>
    <div class="weekdays">
        <div>Monday</div>
        <div>Tuesday</div>
        <div>Wednesday</div>
        <div>Thursday</div>
        <div>Friday</div>
        <div>Saturday</div>
        <div>Sunday</div>
    </div>
    <div class="days">
        @for(int i=0; i < startDay; i++)
        {
            <div class="empty"></div>
        }
        @for (int day = 1; day <= daysInMonth; day++)
        {
            var iterationCurrentDate = new DateTime(currentDate.Year, currentDate.Month, day);
            var fullDate = iterationCurrentDate.ToString("yyyy-MM-dd");
            var isToday = iterationCurrentDate == DateTime.Today ? " today" : "";
            var hasTraining = trainingDays.Any(d => d.Date == iterationCurrentDate.Date) ? " hasTraining" : "";
            <div class="day@(isToday)@(hasTraining)" data-date="@fullDate">@day</div>
        }
    </div>

    <div id="trainingModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <span id="selectedDate"></span>
        </div>
    </div>
</div>

@section Scripts {
            <script>
                document.querySelectorAll('.day').forEach(day => {
                    day.addEventListener('click', () => {
                        const date = day.dataset.date;
                        window.location.href =  `/Training/Index?date=${date}`;
                    });
                });

            </script>
}